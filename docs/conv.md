# Соглашения
## Структура репозитория
* `src/` - файлы с исходным кодом.
    * `lib/` - библиотека.
    * `lib.h` - для подключения библиотеки из основной программы.
* `tools/` - инструменты.
* `default_config.ini` - файл конфигурации с дефолтными настройками для этого репозитория.

## Имена
Названия должны выглядеть так:
* `pk_func_name` - глобальные функции
* `pk_var_name` - глобальные переменные
* `out_param_name` - параметр функции (указатель), через который возвращается значение
* `pkStructName` - глобальные и локальные структуры
* `pkTypeName_t` - глобальные и локальные типы
* `PK_MACRO_NAME` - глобальные макросы (те, что в .h файлах)

На имена объектов, которые объявляются и используются локально, действуют те же правила, но без
префиксов (кроме структур и типов).

Для макросов есть исключения:
* макросы, которые объявленны в .h файле, но не должны быть напрямую использованы извне, именуются
так: `_PK_MACRO_NAME`
* в `lib/log.h` используется `PK` вместо `PK_`
* если макрос должен использоваться в коде как переменная (как `stdout`) или как функция (как
`getchar()`), то можно использовать имя вида `pk_macro_name`.

### POSIX
Стандарт POSIX резервирует все имена типов, имеющие префикс `_t`. Но мне на это насрать. Шанс того,
что имя типа с префиксом `pk` уже занято крайне мал.

## Обработка ошибок
Все ошибки должны выводиться в лог. Если ошибка критическая и не может быть обработана или
проигнорирована, то лучше использовать макрос `PK_ASSERT()`.

## Конфигурация
Параметры, которые могут часто меняться, при этом отличаются для разных устройств, должны быть
заданы в конфигурации.

## Логи
Логи должны кратко, но информативно и своевременно описывать всё, что происходит с платой. Это один
из немногих доступных способов отладки.

`printf()`, `puts()` и всё остальное что пишет в `stdout` лучше заменить на макросы логов, которые
выводят больше полезной информации в удобном виде.
Если всё-таки в `stdout` пишется текст не через макросы логов, то нужно учитывать, что для него
может быть включена буферизация по строкам.

Подробнее см. [log](./log.md)

## Порты
На плате:
* 5256 (TCP) - `ota` сервер.
* 8419 (TCP) - `netlog` сервер контроля рассылки.

UDP broadcast:
* 8419 - `netlog` boot notifications.
